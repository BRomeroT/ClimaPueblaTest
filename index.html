<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <script charset="UTF-8" type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&mkt=es-MX"></script>
    <script src="js/jquery-2.0.3.min.js" type="text/javascript"></script>
    <script src="js/jquery.xdomainajax.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Clima Puebla</title>
</head>
<body>
    <style>
        html, body {
            height: 100%;
        }

        #header {
            background-color: blue;
            min-height: 10px;
        }

        #mapa {
            height: 100%;
        }

        #info {
            background-color: red;
            min-height: 50px;
        }
    </style>
    <div id="header">
    </div>
    <div id="mapa">
        <!--Al9zPH654c2ilovwyubEWKEKfK0Z3q_lFHBf-OIsNRHtv49Pf0cuE3m9pVT3hImU-->
    </div>
    <div id="info">
    </div>
    <script type="text/javascript">
        $(document).bind("mobileinit", function () {
            $.mobile.allowCrossDomainPages = true;
        });
        $(document).ready(function () {
            $.support.cors = true;
            var mapa = new Microsoft.Maps.Map(document.getElementById("mapa"),
                {
                    credentials: "Al9zPH654c2ilovwyubEWKEKfK0Z3q_lFHBf-OIsNRHtv49Pf0cuE3m9pVT3hImU",
                    mapTypeId: Microsoft.Maps.MapTypeId.road,
                    center: new Microsoft.Maps.Location(19.040899, -98.138100),
                    zoom: 7,
                    enableSearchLogo: false,
                    showMapTypeSelector: false,
                });
            CargarEstaciones();

            function CargarEstaciones() {
                var Params = {};
                Params.type = 'GET';
                Params.url = 'http://www.climapuebla.org.mx/ClientBin/Sysne-Clima-Portal-Svr-RIAService.svc/JSON/GetEstaciones';
                //Params.dataType = 'json';
                Params.success = function (res) {
                    var data = $.parseJSON(res.responseText);
                    for (var i in data.GetEstacionesResult.RootResults) {
                        var estacion = data.GetEstacionesResult.RootResults[i];
                        var pos = new Microsoft.Maps.Location(estacion.Latitud, estacion.Longitud)
                        var pin = new Microsoft.Maps.Pushpin(pos, {
                            htmlContent:
                                '<div id="estacion' + estacion.Numero + '"><div style="border-radius:10px;height:10px;width:10px;background-color:' + estacion.ColorDistintivo + ';"/><div></div></div>'
                        });
                        mapa.entities.push(pin);
                        $('#estacion' + estacion.Numero).data('entidad', estacion);
                        Microsoft.Maps.Events.addHandler(pin, 'click', function (e) {
                            var entidad = $('#' + $(e.target._htmlContent).attr('id')).data('entidad');
                            alert(entidad.Nombre);
                        });
                    }
                };

                $.ajax(Params);
            }
        });
    </script>
</body>
</html>
